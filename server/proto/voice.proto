syntax = "proto3";

package live_call;

// Service định nghĩa
service LiveCall {
  rpc StreamCall(stream ClientRequest) returns (stream ServerResponse);
  rpc Check(HealthCheckRequest) returns (HealthCheckResponse);
}

message HealthCheckRequest {
  string service = 1;
}

message HealthCheckResponse {
  enum ServingStatus {
    UNKNOWN = 0;
    SERVING = 1;
    NOT_SERVING = 2;
    SERVICE_UNKNOWN = 3;
  }
  ServingStatus status = 1;
}
// ================= REQUEST (Client -> Server) =================

message ClientRequest {
  bool status = 1; // Map với JSON "status": true

  oneof data {
    InitialInfo initial_info = 2;     // type: "info_call"
    ClientAudioChunk play_audio = 3;  // type: "play_audio"
    DisconnectMessage disconnect = 4; // type: "disconnect"
  }
}

message InitialInfo {
  string workspace_id = 1;
  string call_id = 2;
  string customer_phone_number = 3;
  string type_call = 4; // "inbound" hoặc "outbound"
  string hotline = 5;
  string url_audio_file = 6; // Optional
}

message ClientAudioChunk {
  int32 sample_rate = 1;
  int32 sample_width = 2;
  int32 num_channels = 3;
  float duration = 4;
  string audio_content = 5; // Base64 encoded audio data
}

message DisconnectMessage {}

// ================= RESPONSE (Server -> Client) =================

message ServerResponse {
  bool status = 1; // Map với JSON "status": true/false

  oneof data {
    ServerAudioChunk audio_output = 2;
    SignalMessage signal = 3;
    ErrorMessage error = 4;
  }
}

message ServerAudioChunk {
  int32 sample_rate = 1;
  int32 sample_width = 2;
  int32 num_channels = 3;
  float duration = 4;
  string audio_content = 5; // Base64 encoded audio data
}

message SignalMessage {
  oneof signal_type {
    EndCallSignal end_call = 1;
    TransferCallSignal transfer_call = 2;
  }
}

message EndCallSignal {
  string call_id = 1;
}

message StaffInfo {
  string name = 1;
  string phone_number = 2;
}

message TransferCallSignal {
  string call_id = 1;
  string customer_phone_number = 2;
  repeated StaffInfo target_staff = 3;
}

message ErrorMessage {
  int32 error_code = 1;
  int32 internal_error_code = 2;
  string message = 3;
}